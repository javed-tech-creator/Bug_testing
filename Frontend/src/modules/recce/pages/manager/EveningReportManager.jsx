import React, { useState } from "react";
import {
  ChevronDown,
  ChevronUp,
  Calendar,
  Phone,
  Mail,
  MapPin,
  Download,
  BarChart3,
  TrendingUp,
} from "lucide-react";
import PageHeader from "../../../../components/PageHeader";

const fmt = (n) =>
  typeof n === "number"
    ? new Intl.NumberFormat("en-IN", { style: "currency", currency: "INR" }).format(n)
    : n;

// Mock team data for evening report
const teamReportData = [
  {
    id: 1,
    teamName: "Recce Team A",
    sitesCompleted: 5,
    sitesIncomplete: 1,
    totalArea: 150000,
    photosCollected: 45,
    measurementsDone: 42,
    documentsCollected: 40,
    completion: 83.3,
  },
  {
    id: 2,
    teamName: "Recce Team B",
    sitesCompleted: 4,
    sitesIncomplete: 2,\n    totalArea: 95000,\n    photosCollected: 32,\n    measurementsDone: 30,\n    documentsCollected: 28,\n    completion: 66.7,\n  },\n  {\n    id: 3,\n    teamName: \"Recce Team C\",\n    sitesCompleted: 6,\n    sitesIncomplete: 0,\n    totalArea: 200000,\n    photosCollected: 58,\n    measurementsDone: 55,\n    documentsCollected: 52,\n    completion: 100,\n  },\n];\n\nconst EveningReportManager = () => {\n  const [expandedTeam, setExpandedTeam] = useState(null);\n  const [filterStatus, setFilterStatus] = useState(\"all\");\n\n  const toggleTeamExpand = (id) => {\n    setExpandedTeam(expandedTeam === id ? null : id);\n  };\n\n  // Calculate totals\n  const totalSitesCompleted = teamReportData.reduce((sum, t) => sum + t.sitesCompleted, 0);\n  const totalSitesIncomplete = teamReportData.reduce((sum, t) => sum + t.sitesIncomplete, 0);\n  const totalArea = teamReportData.reduce((sum, t) => sum + t.totalArea, 0);\n  const totalPhotos = teamReportData.reduce((sum, t) => sum + t.photosCollected, 0);\n  const avgCompletion = (\n    teamReportData.reduce((sum, t) => sum + t.completion, 0) / teamReportData.length\n  ).toFixed(1);\n\n  const getCompletionColor = (completion) => {\n    if (completion >= 90) return \"bg-green-50 border-green-200\";\n    if (completion >= 70) return \"bg-amber-50 border-amber-200\";\n    return \"bg-red-50 border-red-200\";\n  };\n\n  const getCompletionTextColor = (completion) => {\n    if (completion >= 90) return \"text-green-700\";\n    if (completion >= 70) return \"text-amber-700\";\n    return \"text-red-700\";\n  };\n\n  return (\n    <div className=\"max-w-7xl mx-auto\">\n      <PageHeader title=\"Evening Report - Manager View\" />\n\n      {/* Dashboard Header */}\n      <div className=\"bg-white border border-gray-200 rounded-md p-4 mb-6\">\n        <div className=\"grid grid-cols-2 md:grid-cols-6 gap-4\">\n          <div className=\"flex flex-col items-center\">\n            <div className=\"text-2xl font-bold text-gray-900\">{teamReportData.length}</div>\n            <div className=\"text-xs text-gray-500 uppercase tracking-wide\">Teams</div>\n          </div>\n          <div className=\"flex flex-col items-center\">\n            <div className=\"text-2xl font-bold text-green-600\">{totalSitesCompleted}</div>\n            <div className=\"text-xs text-gray-500 uppercase tracking-wide\">Completed</div>\n          </div>\n          <div className=\"flex flex-col items-center\">\n            <div className=\"text-2xl font-bold text-red-600\">{totalSitesIncomplete}</div>\n            <div className=\"text-xs text-gray-500 uppercase tracking-wide\">Incomplete</div>\n          </div>\n          <div className=\"flex flex-col items-center\">\n            <div className=\"text-2xl font-bold text-blue-600\">{fmt(totalArea)} sq.ft</div>\n            <div className=\"text-xs text-gray-500 uppercase tracking-wide\">Total Area</div>\n          </div>\n          <div className=\"flex flex-col items-center\">\n            <div className=\"text-2xl font-bold text-purple-600\">{totalPhotos}</div>\n            <div className=\"text-xs text-gray-500 uppercase tracking-wide\">Photos</div>\n          </div>\n          <div className=\"flex flex-col items-center\">\n            <div className=\"text-2xl font-bold text-indigo-600\">{avgCompletion}%</div>\n            <div className=\"text-xs text-gray-500 uppercase tracking-wide\">Avg Completion</div>\n          </div>\n        </div>\n      </div>\n\n      {/* Team Reports */}\n      <div className=\"space-y-4\">\n        {teamReportData.map((team) => (\n          <div key={team.id} className={`border rounded-md p-4 ${getCompletionColor(team.completion)}`}>\n            {/* Team Header */}\n            <div\n              className=\"flex justify-between items-center cursor-pointer\"\n              onClick={() => toggleTeamExpand(team.id)}\n            >\n              <div className=\"flex-1\">\n                <h3 className=\"text-lg font-semibold text-gray-900\">{team.teamName}</h3>\n              </div>\n              <div className=\"flex items-center gap-8 mr-4\">\n                <div className=\"text-right\">\n                  <div className={`text-sm font-bold ${getCompletionTextColor(team.completion)}`}>\n                    {team.completion}%\n                  </div>\n                  <div className=\"text-xs text-gray-500\">Completion</div>\n                </div>\n              </div>\n              <button className=\"p-2 hover:bg-gray-200 rounded\">\n                {expandedTeam === team.id ? (\n                  <ChevronUp className=\"w-5 h-5\" />\n                ) : (\n                  <ChevronDown className=\"w-5 h-5\" />\n                )}\n              </button>\n            </div>\n\n            {/* Team Details */}\n            {expandedTeam === team.id && (\n              <div className=\"mt-4 pt-4 border-t grid grid-cols-2 md:grid-cols-6 gap-4\">\n                <div>\n                  <div className=\"text-2xl font-bold text-gray-900\">{team.sitesCompleted}</div>\n                  <div className=\"text-xs text-gray-500\">Sites Completed</div>\n                </div>\n                <div>\n                  <div className=\"text-2xl font-bold text-gray-900\">{team.sitesIncomplete}</div>\n                  <div className=\"text-xs text-gray-500\">Sites Incomplete</div>\n                </div>\n                <div>\n                  <div className=\"text-2xl font-bold text-gray-900\">{fmt(team.totalArea)} sq.ft</div>\n                  <div className=\"text-xs text-gray-500\">Total Area</div>\n                </div>\n                <div>\n                  <div className=\"text-2xl font-bold text-gray-900\">{team.photosCollected}</div>\n                  <div className=\"text-xs text-gray-500\">Photos</div>\n                </div>\n                <div>\n                  <div className=\"text-2xl font-bold text-gray-900\">{team.measurementsDone}</div>\n                  <div className=\"text-xs text-gray-500\">Measurements</div>\n                </div>\n                <div>\n                  <div className=\"text-2xl font-bold text-gray-900\">{team.documentsCollected}</div>\n                  <div className=\"text-xs text-gray-500\">Documents</div>\n                </div>\n              </div>\n            )}\n          </div>\n        ))}\n      </div>\n\n      {/* Summary Table */}\n      <div className=\"bg-white border border-gray-200 rounded-lg mt-6\">\n        <div className=\"p-4 border-b bg-black rounded-t-lg flex justify-between items-center\">\n          <h3 className=\"text-lg font-semibold text-white\">Team Performance Summary</h3>\n          <button className=\"flex items-center gap-2 px-4 py-2 bg-white text-black rounded hover:bg-gray-100 text-sm\">\n            <Download className=\"w-4 h-4\" />\n            Export\n          </button>\n        </div>\n        <div className=\"overflow-x-auto\">\n          <table className=\"w-full text-sm\">\n            <thead className=\"bg-gray-100 border-b\">\n              <tr>\n                <th className=\"border px-4 py-3 text-left font-semibold\">Team Name</th>\n                <th className=\"border px-4 py-3 text-center font-semibold\">Completed</th>\n                <th className=\"border px-4 py-3 text-center font-semibold\">Incomplete</th>\n                <th className=\"border px-4 py-3 text-center font-semibold\">Total Area</th>\n                <th className=\"border px-4 py-3 text-center font-semibold\">Photos</th>\n                <th className=\"border px-4 py-3 text-center font-semibold\">Measurements</th>\n                <th className=\"border px-4 py-3 text-center font-semibold\">Documents</th>\n                <th className=\"border px-4 py-3 text-center font-semibold\">Completion %</th>\n              </tr>\n            </thead>\n            <tbody>\n              {teamReportData.map((team) => (\n                <tr key={team.id} className=\"hover:bg-gray-50 border-b\">\n                  <td className=\"border px-4 py-3 font-medium\">{team.teamName}</td>\n                  <td className=\"border px-4 py-3 text-center text-green-600\">{team.sitesCompleted}</td>\n                  <td className=\"border px-4 py-3 text-center text-red-600\">{team.sitesIncomplete}</td>\n                  <td className=\"border px-4 py-3 text-center\">{fmt(team.totalArea)} sq.ft</td>\n                  <td className=\"border px-4 py-3 text-center\">{team.photosCollected}</td>\n                  <td className=\"border px-4 py-3 text-center\">{team.measurementsDone}</td>\n                  <td className=\"border px-4 py-3 text-center\">{team.documentsCollected}</td>\n                  <td className={`border px-4 py-3 text-center font-semibold ${getCompletionTextColor(team.completion)}`}>\n                    {team.completion}%\n                  </td>\n                </tr>\n              ))}\n              <tr className=\"bg-gray-100 font-semibold border-b\">\n                <td className=\"border px-4 py-3\">TOTAL</td>\n                <td className=\"border px-4 py-3 text-center text-green-600\">{totalSitesCompleted}</td>\n                <td className=\"border px-4 py-3 text-center text-red-600\">{totalSitesIncomplete}</td>\n                <td className=\"border px-4 py-3 text-center\">{fmt(totalArea)} sq.ft</td>\n                <td className=\"border px-4 py-3 text-center\">{totalPhotos}</td>\n                <td className=\"border px-4 py-3 text-center\">\n                  {teamReportData.reduce((sum, t) => sum + t.measurementsDone, 0)}\n                </td>\n                <td className=\"border px-4 py-3 text-center\">\n                  {teamReportData.reduce((sum, t) => sum + t.documentsCollected, 0)}\n                </td>\n                <td className=\"border px-4 py-3 text-center text-indigo-600\">{avgCompletion}%</td>\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default EveningReportManager;
